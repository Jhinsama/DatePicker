"use strict";!function(y,m){function r(t,e,i,s){s?t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?(t.detachEvent("on"+e,t[e+i]),t[e+i]=null,t["e"+e+i]=null):t["on"+e]=null:t.addEventListener?t.addEventListener(e,i):t.attachEvent?(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t["on"+e]=i}function f(t,e){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var i=[],s=t.getElementsByTagName("*"),a=0;a<s.length;a++)for(var n=s[a].className.split(" "),r=0;r<n.length;r++)if(n[r]===e){i.push(s[a]);break}return i}function k(t,e){if(!t.className)return t.className=e;for(var i=t.className.split(" "),s=!1,a=0;a<i.length;a++)i[a]===e&&(s=!0);s||(t.className+=" "+e)}function v(t,e){if(!t.className||t.className==e)return t.className="";for(var i=t.className.split(" "),s=0;s<i.length;s++)i[s]===e&&(i.splice(s,1),t.className=i.join(" "))}function b(t,e){if(!t.className)return!1;for(var i=!1,s=t.className.split(" "),a=0;a<s.length;a++)s[a]===e&&(i=!0);return i}function u(t,e){if(e instanceof HTMLElement)for(;t&&t!=e;)t=t.parentElement;else{var i=e.split("");if("."==i[0])for(e=e.replace(".","");t;){if(t.className){i=t.className.split(" ");for(var s=!1,a=0;a<i.length;a++)if(i[a]==e){s=!0;break}if(s)break}t=t.parentElement}else if("#"==i[0])for(e=e.replace("#","");t&&t.id!=e;)t=t.parentElement;else for(;t&&t.nodeName.toLowerCase()!=e;)t=t.parentElement}return t}function p(t,e){if(document.createEventObject){var i=document.createEventObject();return t.fireEvent("on"+e,i)}return(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),!t.dispatchEvent(i)}function x(t){for(var e=t.parentNode.children,i=0;i<e.length;i++)if(e[i]===t)return i}function t(t){return this.join="-",this.wW=y.innerWidth,this.wH=y.innerHeight,this.touchState={},this.inputs=Array.prototype.slice.call(f(document,"datepicker"),0),this.maxID=(new Date).getTime(),this.scrollEl=y,this.btnArr={},this._init(t),this.api}y.DatePicker||(t.prototype={_init:function(t){this._setFormat(t),this._initInputs();var e=new Date;this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth(),this.day={},this._create()&&(this._getElement()._mosaicObj(this.currentYear),this._initEvent()),this.api={set:this.set.bind(this),get:this.setCB.bind(this)}},set:function(t,e){var i,s;if(t.length)i=t;else{if(!(t instanceof Object))return console.log("传入的元素不是输入框"),this.api;i=[t]}for(var a=0;a<i.length;a++)if(s=!1,1==(t=i[a]).nodeType&&"input"==t.nodeName.toLowerCase()){for(var n=0;n<this.inputs.length;n++)if(this.inputs[n]===t){s=!0;break}s||(r(t,"focus",this._inputFocus.bind(this,t)),this.inputs.push(t),t.type="text"),e instanceof Object&&(t.datePickerData={min:e.min||null,max:e.max||null},e.range&&(e.bind?0==a?(t.datePickerData.range="start",t.datePickerData.bind=e.bind):1==a?(t.datePickerData.range="end",t.datePickerData.bind=e.bind):t.datePickerData.range="self":t.datePickerData.range="self"))}else console.log(t,"不是输入框");return this.api},setCB:function(t){return t instanceof Function&&(this.callback=t),this.api},prev:function(){var t=this.currentMonth-1;if(t<0){var e=this.currentYear-1;if(e<this.min.year)return!0;this.currentYear=e,this._setYearBox(1,11)}else{if(this.currentYear<=this.min.year&&t<this.min.month)return!0;this.currentMonth=t,this._setYearBox(0,this.currentMonth)}return this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},next:function(){var t=this.currentMonth+1;if(11<t){var e=this.currentYear+1;if(e>this.max.year)return!0;this.currentYear=e,this._setYearBox(1,0)}else{if(this.currentYear>=this.max.year&&t>this.max.month)return!0;this.currentMonth=t,this._setYearBox(0,this.currentMonth)}return this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},_setYearBox:function(t,e,i){i?(i=-i,this.yearBox.style.cssText="-webkit-transform: translateY("+i+"px) translateZ(0);-moz-transform: translateY("+i+"px) translateZ(0);-ms-transform: translateY("+i+"px) translateZ(0);-o-transform: translateY("+i+"px) translateZ(0);transform: translateY("+i+"px) translateZ(0);"):t?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=e,this.yearBox.setAttribute("data-month",e),this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;","number"==typeof e&&this.yearBox.setAttribute("data-month",e))},_prev:function(t){if(!t)return!1;0==this.yearRangePosition&&this._setYearBtnBox(this.yearRangePosition,1);t=t||1;var e=this.yearRangePosition-t;e=e<0?0:e,this.yearRangePosition=e,e*=25,this._setYearBtnBox(e,1)},_next:function(t){if(!t)return!1;var e=this.yearBtns.length/3-4;this.yearRangePosition==e&&this._setYearBtnBox(this.yearRangePosition,1);t=t||1;var i=this.yearRangePosition+t;i=e<i?e:i,this.yearRangePosition=i,i*=25,this._setYearBtnBox(i,1)},_setYearBtnBox:function(t,e){var i="-webkit-transform: translateY("+(t=-t)+"%) translateZ(0);-moz-transform: translateY("+t+"%) translateZ(0);-ms-transform: translateY("+t+"%) translateZ(0);-o-transform: translateY("+t+"%) translateZ(0);transform: translateY("+t+"%) translateZ(0);";e&&(i+="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;"),this.yearBtnBox.style.cssText=i},_back:function(){var t=this.datePicker;b(t,"-year")?v(t,"-year"):v(t,"-show")},_create:function(){var t=document.createElement("style");return t.type="text/css",t.innerHTML="",document.getElementsByTagName("head")[0].appendChild(t),this.datePicker=document.createElement("div"),this.datePicker.className="-date-picker",this.datePicker.innerHTML="<div class='-date-picker-point'><div class='-rotate45'></div></div><div class='-date-picker-main'><div class='-date-picker-foot'><div><div class='-date-picker-ym -d-p-middle'><button id='-date-picker-ym'>"+this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月</button><span class='-dpcymt -rotate45'></span></div></div></div><div class='-date-picker-day'><div><div class='-date-picker-title'><span class='-d-p-middle'>日</span><span class='-d-p-middle'>一</span><span class='-d-p-middle'>二</span><span class='-d-p-middle'>三</span><span class='-d-p-middle'>四</span><span class='-d-p-middle'>五</span><span class='-d-p-middle'>六</span></div><div class='-date-picker-prev'><div class='-rotate45'></div></div><div class='-date-picker-box'><div id='-date-picker-year' data-month='"+this.currentMonth+"' style='-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;'></div></div><div class='-date-picker-next'><div class='-rotate45'></div></div></div></div><div class='-date-picker-btn'><div><div><button class='-date-picker-btn-tday'>今&emsp;天</button></div><div><button class='-date-picker-btn-ystday'>昨&emsp;天</button></div><div><button class='-date-picker-btn-lsweek'>上一周</button></div><div><button class='-date-picker-btn-lsmonth'>上一月</button></div></div></div><div class='-date-picker-select'><div class='-d-p-select-head'><div><div class='-d-p-select-year-touch'><div class='-d-p-select-left'></div><div class='-d-p-select-box'><div id='-d-p-select-year'></div></div><div class='-d-p-select-right'></div></div><button class='-d-p-select-year-range'></button></div></div><div class='-d-p-select-year-month'><div><div class='-d-p-s-year-box'><div class='-d-p-s-year-prev '><div class='-rotate45'></div></div><div class='-d-p-s-y-box'><div id='-d-p-s-y-box'></div></div><div class='-d-p-s-year-next'><div class='-rotate45'></div></div></div><div class='-d-p-s-month-box'><div class='-d-p-s-month' date-month='1'><div class='-d-p-middle'>一月<div class='-d-p-s-m-en'>Jan</div></div></div><div class='-d-p-s-month' date-month='2'><div class='-d-p-middle'>二月<div class='-d-p-s-m-en'>Fed</div></div></div><div class='-d-p-s-month' date-month='3'><div class='-d-p-middle'>三月<div class='-d-p-s-m-en'>Mar</div></div></div><div class='-d-p-s-month' date-month='4'><div class='-d-p-middle'>四月<div class='-d-p-s-m-en'>Apr</div></div></div><div class='-d-p-s-month' date-month='5'><div class='-d-p-middle'>五月<div class='-d-p-s-m-en'>May</div></div></div><div class='-d-p-s-month' date-month='6'><div class='-d-p-middle'>六月<div class='-d-p-s-m-en'>Jun</div></div></div><div class='-d-p-s-month' date-month='7'><div class='-d-p-middle'>七月<div class='-d-p-s-m-en'>Jul</div></div></div><div class='-d-p-s-month' date-month='8'><div class='-d-p-middle'>八月<div class='-d-p-s-m-en'>Aug</div></div></div><div class='-d-p-s-month' date-month='9'><div class='-d-p-middle'>九月<div class='-d-p-s-m-en'>Sep</div></div></div><div class='-d-p-s-month' date-month='10'><div class='-d-p-middle'>十月<div class='-d-p-s-m-en'>Oct</div></div></div><div class='-d-p-s-month' date-month='11'><div class='-d-p-middle'>十一月<div class='-d-p-s-m-en'>Nov</div></div></div><div class='-d-p-s-month' date-month='12'><div class='-d-p-middle'>十二月<div class='-d-p-s-m-en'>Dec</div></div></div></div></div></div></div></div>",document.body.appendChild(this.datePicker),this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",!0},_getElement:function(){return this.point=f(this.datePicker,"-date-picker-point")[0],this.yearMonth=f(this.datePicker,"-date-picker-ym")[0],this.ymBtn=document.getElementById("-date-picker-ym"),this.box=f(this.datePicker,"-date-picker-box")[0],this.yearBox=document.getElementById("-date-picker-year"),this.prevEl=f(this.datePicker,"-date-picker-prev")[0],this.nextEl=f(this.datePicker,"-date-picker-next")[0],this.today=f(this.datePicker,"-date-picker-btn-tday")[0],this.yesterday=f(this.datePicker,"-date-picker-btn-ystday")[0],this.lastWeek=f(this.datePicker,"-date-picker-btn-lsweek")[0],this.lastMonth=f(this.datePicker,"-date-picker-btn-lsmonth")[0],this.yearTouch=f(this.datePicker,"-d-p-select-year-touch")[0],this.yearTouchInner=document.getElementById("-d-p-select-year"),this.yearRange=f(this.datePicker,"-d-p-select-year-range")[0],this.yearPrev=f(this.datePicker,"-d-p-s-year-prev")[0],this.yearNext=f(this.datePicker,"-d-p-s-year-next")[0],this.yearBtnBox=document.getElementById("-d-p-s-y-box"),this.monthBtnBox=f(this.datePicker,"-d-p-s-month-box")[0],this.monthBtns=f(this.datePicker,"-d-p-s-month"),this},_initInputs:function(){for(var t={},e=[],i=0;i<this.inputs.length;i++)if("input"==this.inputs[i].nodeName.toLowerCase()){this.inputs[i].datePickerData={range:this.inputs[i].getAttribute("range"),max:this.inputs[i].getAttribute("max"),min:this.inputs[i].getAttribute("min"),bind:this.inputs[i].getAttribute("bind")};var s=this.inputs[i].datePickerData.bind;if(s){var a=this.inputs[i].datePickerData.min,n=this.inputs[i].datePickerData.max;t[s]||(t[s]={inputs:[],min:null,max:null}),n&&(t[s].max=n),a&&(t[s].min=a),t[s].inputs.push(this.inputs[i])}}else e.push(i);for(var r in t){var h=t[r].inputs;for(i=0;i<h.length;i++)h[i].datePickerData.min=t[r].min,h[i].datePickerData.max=t[r].max}for(i=0;i<e.length;i++)this.inputs.splice(i,1)},_inputFocus:function(t){if(t.blur(),this._inputBlur(t),this.input=t,!this.dateCache){var e=new Date,i=t.datePickerData.min||"2008.01.01",s=t.datePickerData.max;s?"now"==s&&(s=e.getFullYear()+"."+(e.getMonth()+1)+"."+e.getDate()):s=e.getFullYear()+2+".12.31","now"==i&&(i=e.getFullYear()+"."+(e.getMonth()+1)+"."+e.getDate()),i=i.replace(/\D/g,".").replace(".","/").replace(".","/").replace("."," ").replace(".",":").replace(".",":"),s=s.replace(/\D/g,".").replace(".","/").replace(".","/").replace("."," ").replace(".",":").replace(".",":"),e=new Date(i),this.min={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),hours:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()},e=new Date(s),this.max={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),hours:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()}}var a=this._initPicker(t,i);this.datePicker.style.display="block";var n,r=a.top,h=a.height,o=this.wH-this.datePickerH-h;return this.scrollEl===y?(n=r-o,y.scrollTo(0,n)):(n=this.wH-this.datePickerH+this.scrollEl.scrollTop,this.scrollEl.scrollTop=n),!1},_initPicker:function(t,e){v(this.datePicker,"-year"),v(this.datePicker,"-show");var i=new Date,s=i.getFullYear(),a=i.getMonth(),n=i.getDay()||7,r=!1;if(!this.dateCache){this.active&&(this.active=m),s!=this.currentYear&&(this.currentYear=s,r=!0),a!=this.currentMonth&&(this.currentMonth=a,this.yearBox.setAttribute("data-month",a),r=!0),r&&(this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月"),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);var h=new Date(e),o=(i-h)/1e3/60/60/24;o<0?k(this.today,"un"):v(this.today,"un"),o<1?k(this.yesterday,"un"):v(this.yesterday,"un"),!t.datePickerData.range||o-n<1?k(this.lastWeek,"un"):v(this.lastWeek,"un"),i.setDate(0),h.setDate(0),o=(i-h)/1e3/60/60/24,!t.datePickerData.range||o<1?k(this.lastMonth,"un"):v(this.lastMonth,"un"),this._mosaicObj(s)}var c=function(t){var e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight};for(t=t.offsetParent;null!=t;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}(t),d=c.top,l=c.height,u=c.left;c.width;return this.datePicker.style.top=d+l+"px",u+this.datePickerW>this.wW?(this.datePicker.style.left=this.wW-this.datePickerW+"px",this.point.style.left=u-this.wW+this.datePickerW+15+"px"):(this.datePicker.style.left=u+"px",this.point.style.left="10%"),c},_inputBlur:function(t){if(this.dateCache)if(this.dateCache.start&&this.dateCache.end){if(this.dateCache.start!=t&&this.dateCache.end!=t){var e;if("start"==this.dateCache.on){var i=this.dateCache.end.datePickerData.max;if("now"!=i&&i)e=i.replace(".",this.join).replace(".",this.join).replace("."," ").replace(".",":").replace(".",":");else{var s=new Date;e=this._mosaicStr(s.getFullYear(),s.getMonth(),s.getDate())}this.dateCache.end.value=e,this.callback&&this.callback({max:e,min:this.dateCache.str})}else{var a=this.dateCache.end.datePickerData.min;if(a)if("now"==a){s=new Date;e=this._mosaicStr(s.getFullYear(),s.getMonth(),s.getDate())}else e=a.replace(".",this.join).replace(".",this.join).replace("."," ").replace(".",":").replace(".",":");else e=this._mosaicStr(2008,0,1);this.dateCache.start.value=e,this.callback&&this.callback({max:this.dateCache.str,min:e})}this.dateCache=m,v(this.active.btn,"active"),this.active=m,this.btnArr={}}}else t!=this.input&&(this.callback&&this.callback(this.dateCache.str),this.dateCache=m,v(this.active.btn,"active"),this.active=m,this.btnArr={})},_disableEvent:function(t){return(t=t||y.event).preventDefault(),t.stopPropagation(),!1},_defaultTouch:function(t){var e=u((t=t||y.event).target,".-date-picker"),i=u(t.target,"input"),s=!0;if(i)for(var a=0;a<this.inputs.length;a++)if(this.inputs[a]===i){s=!1;break}!e&&s&&(this.datePicker.style.display="none",this._inputBlur())},_TouchS:function(t){var e=e||y.event;return this.touchState.startX=this.touchState.moveX=e.touches[0].clientX,this.touchState.startY=this.touchState.moveY=e.touches[0].clientY,t===this.box?this.boxH=this.box.offsetHeight:t===this.yearTouch?this.touchState.touchPosition=m:t===this.yearBtnBox?this.touchState.touchPosition=m:void 0},_TouchM:function(t){var e=e||y.event,i=e.touches[0].clientX,s=e.touches[0].clientY;if(this.touchState.moveX=i,this.touchState.moveY=s,t===this.box)this._setYearBox(0,0,this.currentMonth*this.boxH+this.touchState.startY-s);else if(t===this.yearTouch){var a=this.yearTouchPosition+(this.touchState.startX-i)/this.yearTouchInner.offsetWidth;this.touchState.touchPosition=a,a*=100,this.yearTouchInner.style.cssText="-webkit-transform: translateZ(0);-moz-transform: translateZ(0);-ms-transform: translateZ(0);-o-transform: translateZ(0);transform: translateZ(0);left: -"+a+"%;"}else{var n=this.yearRangePosition+(this.touchState.startY-s)/this.yearBtnBox.offsetHeight*4;this.touchState.touchPosition=n,n*=25,this._setYearBtnBox(n)}},_TouchE:function(t){if(t===this.box){var e=this.touchState.moveY-this.touchState.startY,i=Math.abs(e)>=this.boxH/4;0<e?(this._setYearBox(0,""),i&&this.prev()):e<0&&(this._setYearBox(0,""),i&&this.next())}else if(t===this.yearTouch){(s=this.touchState.touchPosition)&&(s=s%1<.5?~~s:1+~~s,this._setYTP(s))}else{var s;(s=this.touchState.touchPosition)&&(s=s%1<.5?~~s:1+~~s),(s-=this.yearRangePosition)<0?this._prev(1+~s):this._next(s)}},_mouseO:function(t){if(!this.active)return!1;if(t=t||y.event,this.btnArr.year!=this.currentYear||this.btnArr.month!=this.currentMonth){var e=f(this.yearBox,"-date-picker-month")[this.currentMonth];this.btnArr={year:this.currentYear,month:this.currentMonth,btns:f(e,"-date-picker-date")}}var i,s=this.btnArr.btns;if(i=u(t.target,".-date-picker-date")){var a=x(i)-2;if(this.currentYear>this.active.year)for(var n=0;n<s.length;n++)a<n?v(s[n],"on"):k(s[n],"on");else if(this.currentYear<this.active.year)for(n=0;n<s.length;n++)n<a?v(s[n],"on"):k(s[n],"on");else if(this.currentMonth>this.active.month)for(n=0;n<s.length;n++)a<n?v(s[n],"on"):k(s[n],"on");else if(this.currentMonth<this.active.month)for(n=0;n<s.length;n++)n<a?v(s[n],"on"):k(s[n],"on");else if(a>this.active.index)for(n=0;n<s.length;n++)n>this.active.index&&n<=a?k(s[n],"on"):v(s[n],"on");else if(a<this.active.index)for(n=0;n<s.length;n++)a<=n&&n<this.active.index?k(s[n],"on"):v(s[n],"on");else for(n=0;n<s.length;n++)v(s[n],"on")}},_mouseWheel:function(t){if(this.scroll)return!1;this.scroll=!0;var e=e||y.event;e.preventDefault(),e.stopPropagation();var i=e.detail,s=e.wheelDelta;return i?0<i?t==this.box?this.next():t==this.yearBtnBox?this._next():this._setYTP(this.yearTouchPosition+1):t==this.box?this.prev():t==this.yearBtnBox?this._prev():this._setYTP(this.yearTouchPosition-1):0<s?t==this.box?this.prev():t==this.yearBtnBox?this._prev():this._setYTP(this.yearTouchPosition-1):t==this.box?this.next():t==this.yearBtnBox?this._next():this._setYTP(this.yearTouchPosition+1),delete this.scroll,!1},_setYTP:function(t){var e=this.max.year-this.min.year+4;if(t=t<4?4:e<t?e:t,this.yearTouchInner.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;-webkit-transform: translateZ(0);-moz-transform: translateZ(0);-ms-transform: translateZ(0);-o-transform: translateZ(0);transform: translateZ(0);left: -"+t+"00%;",4==t)for(var i=0;i<12;i++)i<this.min.month?k(this.monthBtns[i],"un"):v(this.monthBtns[i],"un");else if(t==e)for(i=0;i<12;i++)i>this.max.month?k(this.monthBtns[i],"un"):v(this.monthBtns[i],"un");else for(i=0;i<12;i++)v(this.monthBtns[i],"un");this.yearTouchPosition=t,this.cacheYear=this.min.year+t-4},_setRange:function(t,e){e||(e=t);var i=this.input.datePickerData.bind,s=this.input.datePickerData.range,a=this._sortDay(this._mosaicStr(t.year,t.month,t.day),this._mosaicStr(this.min.year,this.min.month,this.min.day)).max,n=this._mosaicStr(e.year,e.month,e.day);if(i&&"start"==s||"end"==s){for(var r,h=0;h<this.inputs.length;h++)if(this.inputs[h].datePickerData.bind==i&&this.inputs[h].datePickerData.range!=s){r=this.inputs[h];break}r?"start"==s?(this.input.value=a,r.value=n):(r.value=a,this.input.value=n):this.input.value=a+("/"==this.join?" - ":" / ")+n}else this.input.value=a+("/"==this.join?" - ":" / ")+n;this.datePicker.style.display="none",this.dateCache=m,this.callback&&this.callback({max:n,min:a})},_click:function(t){var e=e||y.event;if(e.preventDefault(),e.stopPropagation(),t===this.yearMonth){for(var i="",s=this.min.year-4,a=this.max.year+4,n=s;n<=a;n++)i+=n<s+4||a-4<n?"<button class='-d-p-s-y' style='color:#999'>":"<button class='-d-p-s-y'>",i+=n,i+="</button>";this.yearTouchInner.innerHTML=i,k(this.datePicker,"-show"),this._setYTP(this.currentYear-this.min.year+4)}else if(t===this.prevEl)this.prev();else if(t===this.nextEl)this.next();else if(t===this.today){if(b(t,"un"))return!1;var r=new Date;this._setRange({year:r.getFullYear(),month:r.getMonth(),day:r.getDate()})}else if(t===this.yesterday){if(b(t,"un"))return!1;r=new Date;var h=this._testDay(r.getFullYear(),r.getMonth(),r.getDate()-1);this._setRange({year:h.year,month:h.month,day:h.day})}else if(t===this.lastWeek){if(b(t,"un"))return!1;var o=(r=new Date).getDay()||7,c=r.getFullYear(),d=r.getMonth(),l=r.getDate()-o;l<0?(u={year:(h=this._testDay(c,d,l)).year,month:h.month,day:h.day-6},m={year:h.year,month:h.month,day:h.day}):(m={year:c,month:d,day:l},u={year:(h=this._testDay(r.getFullYear(),r.getMonth(),l-6)).year,month:h.month,day:h.day}),this._setRange(u,m)}else if(t===this.lastMonth){if(b(t,"un"))return!1;var u,m;r=new Date;u={year:(h=this._testDay(r.getFullYear(),r.getMonth(),0)).year,month:h.month,day:1},m={year:h.year,month:h.month,day:h.day},this._setRange(u,m)}else if(t===this.yearTouch){this.yearRange.innerText=this.min.year+"-"+this.max.year;c=this.cacheYear||this.currentYear,i="",s=this.min.year-4;var v=(a=this.max.year+4)-s;v<11?a+=11-v:1==(v=(v+1)%3)?a+=2:2==v&&(a+=1);for(n=s;n<=a;n++)i+="<button class='-d-p-s-year",n<this.min.year||n>this.max.year?i+=" un":n==c&&(i+=" in"),i+="' date-year='",i+=n,i+="'>",i+=n,i+="</button>";var p=(a-s+1)/3-4;v=p<(v=~~((c-s)/3)-1)?p:v,this.yearRangePosition=v,v*=25,this._setYearBtnBox(v),this.yearBtnBox.innerHTML=i,k(this.datePicker,"-year"),this.yearBtns=f(this.yearBtnBox,"-d-p-s-year")}else t===this.yearRange?this._back():t===this.yearPrev?this._prev():t===this.yearNext&&this._next();return!1},_unBtnClick:function(t,e){var i=this.currentMonth;switch(t){case"prev":this.prev();break;case"next":this.next()}if(i!=this.currentMonth){for(var s=e.innerText,a=f(f(this.yearBox,"-date-picker-month")[this.currentMonth],"-date-picker-date"),n=0;n<a.length;n++)if(a[n].innerText==s&&!b(a[n],"un")){e=a[n];break}e&&p(e,"click")}},__click:function(t){var e;if((t=t||y.event).preventDefault(),t.stopPropagation(),e=u(t.target,".-date-picker-date"))if(b(e,"prev"))this._unBtnClick("prev",e);else if(b(e,"next"))this._unBtnClick("next",e);else{if(b(e,"un"))return!1;var i=this.currentYear,s=this.currentMonth,a=~~e.innerText,n=this.input.datePickerData.bind,r=this.input.datePickerData.range;if(r){this.dateCache||(this.active={year:i,month:s,day:a,btn:e,index:x(e)-2},k(e,"active"));var h=this._mosaicStr(i,s,a);if(n&&"start"==r||"end"==r)if(this.dateCache){var o=this._sortDay(this.dateCache.str,h);this.callback&&this.callback(o),this.dateCache.start.value=o.min,this.dateCache.end.value=o.max,this.datePicker.style.display="none",this.dateCache=m}else{var c;this.input.value=h,this.dateCache={str:h};for(var d=0;d<this.inputs.length;d++)if(this.inputs[d].datePickerData.bind==n&&this.inputs[d].datePickerData.range!=r){c=this.inputs[d];break}c?("start"==r?(this.dateCache.start=this.input,this.dateCache.end=c):(this.dateCache.end=this.input,this.dateCache.start=c),this.dateCache.on=r,p(c,"focus")):(this.datePicker.style.display="none",this.dateCache=m)}else if(this.dateCache){o=this._sortDay(this.dateCache.str,h);this.callback&&this.callback(o),h=o.min+("/"==this.join?" - ":" / ")+o.max,this.dateCache=m,this.input.value=h,this.datePicker.style.display="none"}else this.dateCache={str:h},this.input.value=h;this.dateCache||(v(this.active.btn,"active"),this.active=m,this.btnArr={})}else this.input.value=this._mosaicStr(i,s,a),this.datePicker.style.display="none"}else if(e=u(t.target,".-d-p-s-year")){if(b(e,"un"))return!1;var l=(i=~~e.innerText)-this.min.year+4;this._setYTP(l),this._back()}else if(e=u(t.target,".-d-p-s-month")){if(b(e,"un"))return!1;i=this.yearTouchPosition+this.min.year-4,s=~~e.getAttribute("date-month")-1;i!=this.currentYear&&(this._mosaicObj(i),this.currentYear=i),this.currentMonth=s,this.yearBox.setAttribute("data-month",s),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",v(this.datePicker,"-show")}},_initEvent:function(){for(var t=0;t<this.inputs.length;t++)r(this.inputs[t],"focus",this._inputFocus.bind(this,this.inputs[t]));r(this.datePicker,"touchmove",this._disableEvent),r(this.yearBox,"click",this.__click.bind(this)),r(this.yearBtnBox,"click",this.__click.bind(this)),r(this.monthBtnBox,"click",this.__click.bind(this)),r(this.yearMonth,"click",this._click.bind(this,this.yearMonth)),r(this.prevEl,"click",this._click.bind(this,this.prevEl)),r(this.nextEl,"click",this._click.bind(this,this.nextEl)),r(this.today,"click",this._click.bind(this,this.today)),r(this.yesterday,"click",this._click.bind(this,this.yesterday)),r(this.lastWeek,"click",this._click.bind(this,this.lastWeek)),r(this.lastMonth,"click",this._click.bind(this,this.lastMonth)),r(this.yearTouch,"click",this._click.bind(this,this.yearTouch)),r(this.yearRange,"click",this._click.bind(this,this.yearRange)),r(this.yearPrev,"click",this._click.bind(this,this.yearPrev)),r(this.yearNext,"click",this._click.bind(this,this.yearNext)),r(document,"touchstart",this._defaultTouch.bind(this)),r(document,"mousedown",this._defaultTouch.bind(this)),r(y,"resize",this._reSize.bind(this)),r(this.box,"touchstart",this._TouchS.bind(this,this.box)),r(this.box,"touchmove",this._TouchM.bind(this,this.box)),r(this.box,"touchend",this._TouchE.bind(this,this.box)),r(this.box,"touchcancel",this._TouchE.bind(this,this.box)),r(this.yearTouch,"touchstart",this._TouchS.bind(this,this.yearTouch)),r(this.yearTouch,"touchmove",this._TouchM.bind(this,this.yearTouch)),r(this.yearTouch,"touchend",this._TouchE.bind(this,this.yearTouch)),r(this.yearTouch,"touchcancel",this._TouchE.bind(this,this.yearTouch)),r(this.yearBtnBox,"touchstart",this._TouchS.bind(this,this.yearBtnBox)),r(this.yearBtnBox,"touchmove",this._TouchM.bind(this,this.yearBtnBox)),r(this.yearBtnBox,"touchend",this._TouchE.bind(this,this.yearBtnBox)),r(this.yearBtnBox,"touchcancel",this._TouchE.bind(this,this.yearBtnBox)),/.*Firefox.*/.test(navigator.userAgent)?(r(this.box,"DOMMouseScroll",this._mouseWheel.bind(this,this.box)),r(this.yearTouch,"DOMMouseScroll",this._mouseWheel.bind(this,this.yearTouch)),r(this.yearBtnBox,"DOMMouseScroll",this._mouseWheel.bind(this,this.yearBtnBox))):(r(this.box,"mousewheel",this._mouseWheel.bind(this,this.box)),r(this.yearTouch,"mousewheel",this._mouseWheel.bind(this,this.yearTouch)),r(this.yearBtnBox,"mousewheel",this._mouseWheel.bind(this,this.yearBtnBox))),r(this.box,"mouseover",this._mouseO.bind(this))},_setFormat:function(t){if("string"!=typeof t)return this.format="YYYY-MM-DD";null==t.match(/\d/)&&null!=t.match(/YYYY(?!Y)/)&&null!=t.match(/MM(?!M)/)&&null!=t.match(/DD(?!D)/)?null!=(this.format=t).match(/hh(?!h)/)&&(this.hasDate=!0):this.format="YYYY-MM-DD"},_sortDay:function(t,e){var i,s,a=new Date(t.replace(this.join,"/").replace(this.join,"/"));return new Date(e.replace(this.join,"/").replace(this.join,"/"))<a?(i=t,s=e):(s=t,i=e),{max:i,min:s}},_testDay:function(t,e,i){return i<1&&(--e<0&&(e=11,t--),i+=0==e||2==e||4==e||6==e||7==e||9==e||11==e?31:3==e||5==e||8==e||10==e?30:t%4==0?29:28),{year:t,month:e,day:i}},_mosaicObj:function(t){var e="<div class='-prev-year'>上一年</div>";if(this.day[t])for(i=0;i<12;i++)e+=this.day[t][i];else{this.day[t]=[];for(var i=1;i<=12;i++){var s=this._mosaicMonth(t,i);e+=this.day[t][i-1]=s}}e+="<div class='-next-year'>下一年</div>",this.yearBox.innerHTML=e;var a,n=f(this.yearBox,"-date-picker-month");if(this.active&&t==this.active.year&&(a=f(n[this.active.month],"-date-picker-date"),this.active.btn=a[this.active.index],k(this.active.btn,"active")),this.min||this.max){if(this.min.year==t){a=f(n[this.min.month],"-date-picker-date");for(i=0;i<a.length;i++)if(!b(a[i],"un")){if(!(~~a[i].innerText<this.min.day))break;k(a[i],"un")}}if(this.max.year==t)for(i=(a=f(n[this.max.month],"-date-picker-date")).length-1;-1<i;i--)if(!b(a[i],"un")){if(!(~~a[i].innerText>this.max.day))break;k(a[i],"un")}}},_mosaicMonth:function(t,e){var i,s,a=t%4==0,n="<div class='-date-picker-month'><div class='-before'>"+e+"</div><div class='-after'>"+e+"</div>",r=new Date(t+"/"+e+"/1").getDay()||7;return 1==e?i=s=31:2==e?(i=a?29:28,s=31):3==e?(i=31,s=a?29:28):4==e||4==e||9==e||11==e?(i=30,s=31):5==e||7==e||10==e||12==e?(i=31,s=30):s=i=31,n+=this._mosaicDate(t,e,r,s-r),n+=this._mosaicDate(t,e,i),r+=i,n+=this._mosaicDate(t,e,42-r),n+="</div>"},_mosaicDate:function(t,e,i,s){var a=new Date,n=a.getFullYear(),r=a.getMonth()+1,h=a.getDate()-1,o="";s=s||0;for(var c=0;c<i;c++)o+="<button class='-date-picker-date",0<s||i<28?(o+=" un",o+=0<s?" prev":" next",o+="'>",c+s<9&&(o+="&ensp;"),o+=c+s+1):(c==h&&e==r&&t==n&&(o+=" in"),o+="'>",c<9&&(o+="&ensp;"),o+=c+1),o+="</button>";return o},_mosaicStr:function(t,e,i,s,a,n){var r;return r=t+this.join+(e<9?"0"+(e+1):e+1)+this.join+(i<10?"0"+i:i),s!=m&&(r+=" ",r+=s,r+=":",r+=a?a<10?"0"+a:a:"00",r+=":",r+=n?n<10?"0"+n:n:"00"),r},_resetStr:function(t){for(var e=this.format.replace(/YYYY(?!Y)/,0).replace(/MM(?!M)/,1).replace(/DD(?!D)/,2).replace(/hh(?!h)/,3).replace(/mm(?!m)/,4).replace(/ss(?!s)/,5).replace(/\D/g," ").split(" "),i=t.replace(/\D/g," ").split(" "),s=[],a=0;a<i.length;a++)e[a]&&(s[e[a]]=i[a]);t=s[0]+"/"+s[1]+"/"+s[2];return s[3]&&(t+=" ",t+=s[3],s[4]||(s[4]="00"),t+=":",t+=s[4],s[5]||(s[5]="00"),t+=":",t+=s[5]),{obj:s,str:t}},_reSize:function(){this.wW=y.innerWidth,this.wH=y.innerHeight,this.datePicker.style.visibility="hidden",this.datePicker.style.display="block",this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",this.datePicker.style.visibility="visible"}},y.DatePicker=t)}(window);